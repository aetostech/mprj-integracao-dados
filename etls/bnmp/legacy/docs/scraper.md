Module bnmp.scraper
===================
BNMP API scraper.

Scraps warrants data from the BNMP API.

Functions
---------

    
`scraper(event: Dict[Union[str, Literal['api_map']], Union[Any, List[dict]]], context: aws_lambda_powertools.utilities.typing.lambda_context.LambdaContext = None)`
:   AWS Lambda controller function.
    
    Args:
        event: A key ``api_map`` must contain a list with one or more API maps.
        Example ``"api_map":[{"state": 1, "state_probe": 6598, "include_desc":
        false}]``
        context: A AWS Lambda Context given during the AWS Lambda execution.

Classes
-------

`BulkScraper()`
:   Scrap general warrants data from the BNMP API.
    
    The data scraped by this class is the same exibited by the BNMP's web
    interface.
    
    Warrants already scraped in anterior runs have their last seen dates
    updated on Redshift. New warrants are directed for detailed scraping.
    
    Extract DB connection parameters.

    ### Methods

    `calc_range(self, depth: int) ‑> range`
    :   Calculate the page range needed to reach a given depth.
        
        The maximum value is 5 as the API can only return 10.000 results in a
        given query.
        
        Args:
            depth: Ammount of pages
        
        Returns:
            Range (depth) needed to reach all the pages with data.

    `requester(self, api_map) ‑> Generator[+T_co, -T_contra, +V_co]`
    :   Request data from the API.
        
        Args:
            api_map: API map.
        
        Returns:
            Generator with pages returned by the API.

    `scrap(self, api_map: Dict[Union[str, Literal['api_map']], Union[Any, List[dict]]]) ‑> Tuple[Set[Tuple[str, str, str, datetime.date, datetime.date, str]], str]`
    :   Extract warrants general data.
        
        Args:
            api_map: The event received by `scraper`.
        
        Returns:
            A set with all the new warrants that need detailed scraping and the
            id of the current state being scraped.

    `threads(self, api_map: List[Dict[Any, Any]]) ‑> Generator[+T_co, -T_contra, +V_co]`
    :   Create and run a requests threadpool and yield data.
        
        Args:
            api_map: API maps
        
        Returns:
            Generator with bulk data received from the API.

`DetailsScraper()`
:   Scrap detailed warrant data from the BNMP API.
    
    The data scraped by this class is the same that fills the detailed PDF
    reports generated by the BNMP API.
    
    All warrants will be inserted on Redshift on the end of the run.
    
    Instantiate `Redshift` class.

    ### Methods

    `load_url(self, item: Tuple[str, str, str, datetime.date, datetime.date, str]) ‑> Optional[None]`
    :   Return detailed warrant data.
        
        Args:
            item: Bulk warrant data.
        
        Returns:
            Detailed data from warrant if it is filled with valid data.

    `scrap(self, bulk_warrants: Set[Tuple[str, str, str, datetime.date, datetime.date, str]], state_id: str) ‑> None`
    :   Add detailed data from the BNMP API into a temporary table.
        
        Args:
            bulk_warrants: Iterable containing bulk warrant data.
            state_id: A state id.

    `threads(self, items: Set[Tuple[str, str, str, datetime.date, datetime.date, str]]) ‑> Generator[Optional[None], None, None]`
    :   Create and run a requests threadpool and yield valid data.
        
        Args:
            items: Set of tuples with bulk warrants data.
        
        Returns:
            Generator with detailed data for each warrant that received a valid
            response with valid data.